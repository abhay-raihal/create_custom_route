<?php

namespace RZP\Tests\Functional\UserRole\Banking\Dashboard;

use RZP\Models\Merchant;
use RZP\Services\RazorXClient;
use RZP\Models\User\AxisUserRole;

trait AxisBankingRoleTrait
{
    private function getUserRoleRouteMap()
    {
        return [
            AxisUserRole::AUTHORISED_SIGNATORY => [
                'payout_bulk_create',
                'payout_create_with_otp',
                'payout_approve_bulk',
                'payout_reject_bulk',
                'payout_approve',
                'payout_reject',
                'payout_fetch_by_id',
                'payout_fetch_multiple',
                'payout_cancel',
                'payout_purpose_get',
                'payout_purpose_post',
                'payout_fetch_reversals',
                'payouts_summary',
                'payouts_workflow_summary',
                'payout_links_fetch_multiple',
                'payout_links_fetch_by_id',
                'payout_links_create',
                'payout_links_cancel',
                'merchant_edit_config_logo',
                'payout_links_merchant_settings_get',
                'payout_links_merchant_settings_post',
                'payout_links_merchant_on_boarding_status',
                'payout_links_merchant_summary',
                'payout_links_resend_notification',
                'contact_get',
                'contact_list',
                'contact_create',
                'bulk_contact_create',
                'contact_update',
                'contact_types_get',
                'contact_types_post',
                'fund_account_validate',
                'fund_account_validate_fetch',
                'fund_account_validate_fetch_by_id',
                'fund_account_get',
                'fund_account_list',
                'fund_account_create',
                'fund_account_update',
                'fund_account_bulk_create',
                'merchant_create_key',
                'merchant_fetch_keys',
                'merchant_replace_key',
                'merchant_analytics',
                'merchant_balance_fetch',
                'merchant_invoice_fetch_multiple',
                'user_edit_self',
                'user_fetch',
                'merchant_fetch_users',
                'webhook_create',
                'webhook_edit',
                'webhook_delete',
                'webhook_fetch',
                'webhook_fetch_events',
                'webhook_fetch_multiple',
                'oauth_app_webhook_create',
                'reporting_log_get',
                'reporting_log_list',
                'reporting_log_create',
                'transaction_statement_fetch',
                'transaction_statement_fetch_multiple',
                'invitation_create',
                'invitation_fetch_by_token',
                'invitation_fetch',
                'invitation_resend',
                'invitation_edit',
                'invitation_delete',
                'invitation_action',
                'reporting_config_edit',
                'reporting_config_delete',
                'reporting_log_get',
                'reporting_log_list',
                'reporting_log_create',
                'reporting_log_update',
                'bank_transfer_process_test',
                'merchant_document_upload',
                'merchant_document_delete',
                'merchant_bank_account_change_status',
                'merchant_2fa_change_setting',
                'user_account_unlock',
            ],
            AxisUserRole::CC_ADMIN => [
                'payout_bulk_create',
                'payout_create_with_otp',
                'payout_approve_bulk',
                'payout_reject_bulk',
                'payout_approve',
                'payout_reject',
                'payout_fetch_by_id',
                'payout_fetch_multiple',
                'payout_cancel',
                'payout_purpose_get',
                'payout_purpose_post',
                'payout_fetch_reversals',
                'payouts_summary',
                'payouts_workflow_summary',
                'payout_links_fetch_multiple',
                'payout_links_fetch_by_id',
                'payout_links_create',
                'payout_links_cancel',
                'payout_links_merchant_settings_get',
                'payout_links_merchant_settings_post',
                'payout_links_merchant_on_boarding_status',
                'payout_links_merchant_summary',
                'payout_links_resend_notification',
                'merchant_edit_config_logo',
                'contact_get',
                'contact_list',
                'contact_create',
                'bulk_contact_create',
                'contact_update',
                'contact_types_get',
                'contact_types_post',
                'fund_account_validate',
                'fund_account_validate_fetch',
                'fund_account_validate_fetch_by_id',
                'fund_account_get',
                'fund_account_list',
                'fund_account_create',
                'fund_account_update',
                'fund_account_bulk_create',
                'merchant_create_key',
                'merchant_fetch_keys',
                'merchant_replace_key',
                'merchant_analytics',
                'merchant_balance_fetch',
                'merchant_invoice_fetch_multiple',
                'user_edit_self',
                'user_fetch',
                'merchant_fetch_users',
                'webhook_create',
                'webhook_edit',
                'webhook_delete',
                'webhook_fetch',
                'webhook_fetch_events',
                'webhook_fetch_multiple',
                'oauth_app_webhook_create',
                'reporting_log_get',
                'reporting_log_list',
                'reporting_log_create',
                'transaction_statement_fetch',
                'transaction_statement_fetch_multiple',
                'reporting_config_edit',
                'reporting_config_delete',
                'reporting_log_get',
                'reporting_log_list',
                'reporting_log_create',
                'reporting_log_update',
                'bank_transfer_process_test',
                'merchant_features_update',
                'merchant_2fa_change_setting',
                'user_account_unlock',
            ],
            AxisUserRole::MAKER => [
                'payout_bulk_create',
                'payout_create_with_otp',
                'payout_approve_bulk',
                'payout_reject_bulk',
                'payout_approve',
                'payout_reject',
                'payout_fetch_by_id',
                'payout_fetch_multiple',
                'payout_cancel',
                'payout_purpose_get',
                'payout_purpose_post',
                'payout_fetch_reversals',
                'payouts_summary',
                'payouts_workflow_summary',
                'payout_links_fetch_multiple',
                'payout_links_fetch_by_id',
                'payout_links_create',
                'payout_links_cancel',
                'payout_links_merchant_settings_get',
                'payout_links_merchant_settings_post',
                'payout_links_merchant_on_boarding_status',
                'payout_links_merchant_summary',
                'payout_links_resend_notification',
                'merchant_edit_config_logo',
                'contact_get',
                'contact_list',
                'contact_create',
                'bulk_contact_create',
                'contact_update',
                'contact_types_get',
                'contact_types_post',
                'fund_account_validate',
                'fund_account_validate_fetch',
                'fund_account_validate_fetch_by_id',
                'fund_account_get',
                'fund_account_list',
                'fund_account_create',
                'fund_account_update',
                'fund_account_bulk_create',
                'merchant_create_key',
                'merchant_fetch_keys',
                'merchant_replace_key',
                'merchant_analytics',
                'merchant_balance_fetch',
                'merchant_invoice_fetch_multiple',
                'user_edit_self',
                'user_fetch',
                'merchant_fetch_users',
                'webhook_create',
                'webhook_edit',
                'webhook_delete',
                'webhook_fetch',
                'webhook_fetch_events',
                'webhook_fetch_multiple',
                'oauth_app_webhook_create',
                'reporting_log_get',
                'reporting_log_list',
                'reporting_log_create',
                'transaction_statement_fetch',
                'transaction_statement_fetch_multiple',
                'reporting_config_edit',
                'reporting_config_delete',
                'reporting_log_get',
                'reporting_log_list',
                'reporting_log_create',
                'reporting_log_update',
                'bank_transfer_process_test',
                'merchant_features_update',
                'merchant_2fa_change_setting',
                'user_account_unlock',
            ],
            AxisUserRole::CHECKER_L1 => [
                'payout_bulk_create',
                'payout_create_with_otp',
                'payout_approve_bulk',
                'payout_reject_bulk',
                'payout_approve',
                'payout_reject',
                'payout_fetch_by_id',
                'payout_fetch_multiple',
                'payout_cancel',
                'payout_purpose_get',
                'payout_purpose_post',
                'payout_fetch_reversals',
                'payouts_summary',
                'payouts_workflow_summary',
                'payout_links_fetch_multiple',
                'payout_links_fetch_by_id',
                'payout_links_create',
                'payout_links_cancel',
                'payout_links_merchant_settings_get',
                'payout_links_merchant_settings_post',
                'payout_links_merchant_on_boarding_status',
                'payout_links_merchant_summary',
                'payout_links_resend_notification',
                'merchant_edit_config_logo',
                'contact_get',
                'contact_list',
                'contact_create',
                'bulk_contact_create',
                'contact_update',
                'contact_types_get',
                'contact_types_post',
                'fund_account_validate',
                'fund_account_validate_fetch',
                'fund_account_validate_fetch_by_id',
                'fund_account_get',
                'fund_account_list',
                'fund_account_create',
                'fund_account_update',
                'fund_account_bulk_create',
                'merchant_create_key',
                'merchant_analytics',
                'merchant_balance_fetch',
                'user_edit_self',
                'user_fetch',
                'merchant_fetch_users',
                'webhook_create',
                'webhook_edit',
                'webhook_delete',
                'webhook_fetch',
                'webhook_fetch_events',
                'webhook_fetch_multiple',
                'oauth_app_webhook_create',
                'reporting_log_get',
                'reporting_log_list',
                'reporting_log_create',
                'transaction_statement_fetch',
                'transaction_statement_fetch_multiple',
                'reporting_config_edit',
                'reporting_config_delete',
                'reporting_log_get',
                'reporting_log_list',
                'reporting_log_create',
                'reporting_log_update',
                'bank_transfer_process_test',
            ],

            AxisUserRole::MAKER_ADMIN => [
                'user_otp_create',
                'user_edit_self',
                'user_fetch',
                'reporting_log_get',
                'payout_fetch_by_id',
                'payout_links_fetch_multiple',
                'payout_links_create',
                'payout_links_cancel',
                'payout_links_merchant_settings_get',
                'payout_links_merchant_settings_post',
                'payout_links_merchant_on_boarding_status',
                'payout_links_merchant_summary',
                'payout_links_resend_notification',
                'merchant_edit_config_logo',
            ],

            AxisUserRole::VIEWER => [
                'payout_fetch_by_id',
                'payout_purpose_get',
                'payout_fetch_reversals',
                'payouts_summary',
                'payout_links_fetch_multiple',
                'payout_links_fetch_by_id',
                'payouts_workflow_summary',
                'contact_get',
                'contact_list',
                'contact_types_get',
                'fund_account_validate_fetch',
                'fund_account_get',
                'fund_account_list',
                'merchant_fetch_keys',
                'merchant_analytics',
                'merchant_balance_fetch',
                'merchant_invoice_fetch_multiple',
                'user_fetch',
                'merchant_fetch_users',
                'webhook_fetch',
                'webhook_fetch_multiple',
                'webhook_fetch_events',
                'reporting_log_get',
                'reporting_log_list',
                'transaction_statement_fetch',
                'transaction_statement_fetch_multiple',
                'reporting_config_get',
                'reporting_config_list',
                'reporting_log_create',
                'merchant_product_switch',
                'payout_links_merchant_summary',
                'payout_links_merchant_on_boarding_status',
                'user_edit_self',
            ]
        ];
    }

    protected function getUserRolePermissibleRouteMap(string $role)
    {
        return $this->getUserRoleRouteMap()[$role] ?? null;
    }

    protected function mockRazorXTreatmentAccessDenyUnauthorised($value = 'on')
    {
        $razorxMock = $this->getMockBuilder(RazorXClient::class)
            ->setConstructorArgs([$this->app])
            ->setMethods(['getTreatment'])
            ->getMock();

        $this->app->instance('razorx', $razorxMock);

        $this->app->razorx->method('getTreatment')
            ->will($this->returnCallback(
                function ($mid, $feature, $mode) use ($value)
                {
                    if ($feature === Merchant\RazorxTreatment::RAZORPAY_X_ACL_DENY_UNAUTHORISED)
                    {
                        return $value;
                    }

                    return 'off';
                }));
    }
}
